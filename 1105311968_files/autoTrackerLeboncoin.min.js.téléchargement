/* SPT */!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AutoTrack=e():t.AutoTrack=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=23)}([function(t,e,i){"use strict";function n(t,e,i){var n,o=1;if(!t||"number"!=typeof t)throw new Error("times required");if(!e||"function"!=typeof e)throw new Error("task required");if(!i||"function"!=typeof i)throw new Error("callback required");n=function(){arguments[0]&&o>=t?i.apply(null,arguments):arguments[0]?(o+=1,e(n)):i.apply(null,arguments)},e(n)}function o(){var t,e;return"undefined"!=typeof window.innerWidth?(t=window.innerWidth,e=window.innerHeight):"undefined"!=typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?(t=document.documentElement.clientWidth,e=document.documentElement.clientHeight):(t=document.getElementsByTagName("body")[0].clientWidth,e=document.getElementsByTagName("body")[0].clientHeight),t+"x"+e}function r(){var t;return navigator.userLanguage?t=navigator.userLanguage:navigator.language&&(t=navigator.language),t}function s(t){var e={mobile:["iPhone;","iPod;","iPod touch;","^HTC","Fennec","IEMobile","BB10;","BlackBerry","SymbianOS.*AppleWebKit","^Mozilla.*Mobile.*Firefox","^Mozilla.*Chrome.*Mobile","Opera Mobi","Android.*Mobile","Android.*Mini","Symbian","^SonyEricsson","^Nokia","^SAMSUNG","^LG"],tablet:["iPad;","Android"]},i=function(e){var i,n=0;for(n;n<e.length;n++)if(i=e[n],t.match(new RegExp(i)))return!0;return!1};if(t){if(i(e.mobile))return"mobile";if(i(e.tablet))return"tablet"}return"desktop"}function a(){var t=new Date,e=-t.getTimezoneOffset(),i=e>=0?"+":"-",n=function(t){var e=Math.abs(Math.floor(t));return(e<10?"0":"")+e},o=t.getFullYear()+"-"+n(t.getMonth()+1)+"-"+n(t.getDate());return o=o+"T"+n(t.getHours())+":"+n(t.getMinutes()),o=o+":"+n(t.getSeconds()),o=o+i+n(e/60)+":"+n(e%60)}function c(){var t,e,i="",n=function(){return window.crypto?window.crypto.getRandomValues(new Uint8Array(1))[0]/256:Math.random()};for(e=0;e<36;e++)t=14===e?4:19===e?Math.floor(4*n()+8).toString(16):8===e||13===e||18===e||23===e?"-":Math.floor(16*n()).toString(16),i+=t;return i}function d(t){var e,i,n=[],o=location.search,r=o.split("&"),s=new RegExp(t+"=([^&;]+?)(&|#|;|$)","i");for(i=0;i<r.length;i++)e=r[i].match(s),e&&n.push(e[1]);return n}function u(){return(window.pageYOffset||document.scrollTop)-(document.clientTop||0)}function h(){var t,e,i;if(!window.performance)return null;t=window.performance.timing.domLoading,e=(new Date).getTime();try{i=e-t}catch(t){i=null}return i}function p(){localStorage.setItem("pulse2-val","check"),localStorage.removeItem("pulse2-val")}function l(t){return"[object Array]"===Object.prototype.toString.call(t)}function f(t){var e,i,n=Object.prototype.hasOwnProperty,o=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],s=r.length,a=[];if("object"!==("undefined"==typeof t?"undefined":I(t))&&("function"!=typeof t||null===t))throw new TypeError("Object.keys called on non-object");for(e in t)n.call(t,e)&&a.push(e);if(o)for(i=0;i<s;i++)n.call(t,r[i])&&a.push(r[i]);return a}function y(){return(new Date).getTime()}function g(t){var e=decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||!1;return e}function v(t,e){var i=t+"=";e&&(i+=";domain="+e,i+=";path=/"),i+=";expires=Thu, 01 Jan 1970 00:00:01 GMT",document.cookie=i}function m(t,e,i,n){var o;o=t+"="+e,o+=";domain="+i,o+=";path=/",o+=";expires="+n,document.cookie=o}function b(t){return"m.finn.no"===t?"finn.no":t.replace(/^www\./,"")}Object.defineProperty(e,"__esModule",{value:!0});var I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.retry=n,e.getViewportDimensions=o,e.getDeviceLanguage=r,e.getDeviceType=s,e.getTimestamp=a,e.getUuidV4=c,e.getUrlParams=d,e.getScrollPosition=u,e.getViewDuration=h,e.checkLocalStorage=p,e.isArray=l,e.objectKeys=f,e.dateNow=y,e.getCookie=g,e.deleteCookie=v,e.writeCookie=m,e.broadenDomain=b},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(e?console.log:a)(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.debug=o;var r=i(13),s=n(r),a=(0,s.default)("spt:pulse")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(19);Object.keys(n).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return n[t]}})})},function(t,e,i){"use strict";function n(){}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(0);n.prototype.getUrlWithCorrectProtocol=function(t){var e=t.split("://");return"//"+e.pop()},n.prototype.getXHR=function(t,e,i){var n;return"undefined"!=typeof XDomainRequest?(n=new XDomainRequest,n.open(e.toLowerCase(),this.getUrlWithCorrectProtocol(i)),n):(n=new XMLHttpRequest,"withCredentials"in n&&(n.open(e,i),n.setRequestHeader("Content-Type","application/json; charset=utf-8"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),t&&(n.withCredentials=!0),n))},n.prototype.addDataToUrl=function(t,e){var i,n;if(!e||"object"!==("undefined"==typeof e?"undefined":o(e)))return t;for(i=(0,r.objectKeys)(e);i&&"object"===o(e[i[0]]);)i.shift();for(t=this.appendParameterToUrl(t,i[0],e[i[0]],"?"),n=1;n<i.length;n++)t=this.appendParameterToUrl(t,i[n],e[i[n]],"&");return t},n.prototype.appendParameterToUrl=function(t,e,i,n){return"object"!==("undefined"==typeof i?"undefined":o(i))?t+n+encodeURIComponent(e)+"="+encodeURIComponent(i):t},n.prototype.post=function(t,e,i,n,r){return t?e&&"object"===("undefined"==typeof e?"undefined":o(e))?(n=n||!1,void this.send(t,e,i,n,r,"POST")):i("data required"):i("url required")},n.prototype.get=function(t,e,i,n,o){return t?(e&&(t=this.addDataToUrl(t,e)),void this.send(t,e,i,o,n,"GET")):i("url required")},n.prototype.send=function(t,e,i,n,o,s){var a=this;if(!i)throw new Error("callback required");o=o||3,(0,r.retry)(o,function(i){var o=a.getXHR(n,s,t);if(o||i("Failed to identify request method"),"undefined"!=typeof XDomainRequest?(o.onload=function(){i(null,o)},o.onprogress=function(){},o.onerror=function(){i("Failed request"),o.abort()},o.ontimeout=o.onerror):o.onreadystatechange=function(){4===o.readyState&&(200===o.status?i(null,o):i("Failed with status "+o.status))},"POST"===s)try{o.send(JSON.stringify(e))}catch(t){i(t.name+": "+t.message)}else if("GET"===s)try{o.send()}catch(t){i(t)}},i)},e.default=n},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){t=t||{},t.pageLoad!==!1&&l.pageLoad(k),t.pageUnload&&k.queue.loadFromLocalStorage(),t.hashChange===!0&&l.hashChange(k),t.pageUnload===!0&&l.pageUnload(k),t.clickButton===!0&&y.button(k),t.engagement===!0&&v.engagement(k),t.relativeScroll===!0&&b.trackScrollRelative(k,25),t.itemVisible===!0&&b.trackScrollItems(k)}function s(t){O!==!0&&(O=!0,r(t.trackingFeatures),w.impliedEvents(k))}function a(t,e){var i=t.throttle||1;if(e===!0&&(O=!1),Math.random()<i)return k=new S.default(t),"complete"===document.readyState||"interactive"===document.readyState?s(t):(window.addEventListener("DOMContentLoaded",function(){s(t)},!1),window.addEventListener("load",function(){s(t)},!1)),k.getPageViewId()}function c(){return k.getPageViewId()}function d(){k.userLogout()}function u(t){k.userLogin(t)}function h(){return k}Object.defineProperty(e,"__esModule",{value:!0}),e.initTracking=a,e.getPageViewId=c,e.logoutEvent=d,e.loginEvent=u,e.activity=h;var p=i(9),l=o(p),f=i(6),y=o(f),g=i(7),v=o(g),m=i(10),b=o(m),I=i(8),w=o(I),j=i(11),S=n(j),k={},O=!1},function(t,e,i){"use strict";function n(t){var e=new Image,i=t.url+"?r="+Math.random();t.userId&&(i+="&id="+t.userId),e.src=i}Object.defineProperty(e,"__esModule",{value:!0}),e.initCookieSync=n},function(t,e,i){"use strict";function n(t){document.addEventListener("click",function(e){var i=e.target||e.srcElement;/.*track-click.*/.test(i.className)&&t.events.trackClick(i.id).send()},!1)}Object.defineProperty(e,"__esModule",{value:!0}),e.button=n},function(t,e,i){"use strict";function n(t){document.addEventListener("click",function(e){var i=e.target||e.srcElement;/.*track-engagement.*/.test(i.className)&&t.events.trackEngagement((0,o.getViewDuration)(),(0,o.getScrollPosition)(),"Click",i.tagName,i.id,i.getAttribute("p2-action"),i.getAttribute("p2-meta")).send()},!1)}Object.defineProperty(e,"__esModule",{value:!0}),e.engagement=n;var o=i(0)},function(t,e,i){"use strict";function n(t){function e(t,e,i){return t[e]?t[e]:i}var i=t.opts.impliedEvents;i&&i.map(function(i){var n;switch(n=i.params,i.track.toLowerCase()){case"create":t.events.trackCreate(e(n,0),e(n,1),e(n,2,{})).send();break;case"login":t.events.trackLogin(e(n,0),e(n,1),e(n,2,{})).send();break;case"logout":t.events.trackLogout(e(n,0),e(n,1),e(n,2,{})).send();break;case"reply":t.events.trackReply(e(n,0),e(n,1),e(n,2,{})).send();break;case"update":t.events.trackUpdate(e(n,0),e(n,1),e(n,2,{})).send();break;case"refer":t.events.trackRefer(e(n,0),e(n,1),e(n,2,{})).send();break;case"report":t.events.trackReport(e(n,0),e(n,1),e(n,2,{})).send()}})}Object.defineProperty(e,"__esModule",{value:!0}),e.impliedEvents=n},function(t,e,i){"use strict";function n(t){t.events.trackContentView().send()}function o(t){document.addEventListener("hashchange",function(){t.events.trackContentView().send()},!1)}function r(t){function e(){n||(n=!0,t.events.trackEngagementTime((0,s.dateNow)()-i).queue(),t.events.trackExit().queue(),t.queue.persistToLocalStorage())}var i=(0,s.dateNow)(),n=!1;document.addEventListener("click",function(e){var o,r,a,c;n&&(n=!0,o=e.target,"a"===o.tagName.toLowerCase()&&(r=o.getAttribute("href"),a=/^https?:\/\//i,r.match(a)&&(t.events.trackEngagementTime((0,s.dateNow)()-i).queue(),c=t.events.trackExit("sdrn:exit:"+r,"Page"),c.addProperty("secondary","url",r),c.queue(),t.sendQueue())))},!1),window.addEventListener("beforeunload",e),window.addEventListener("unload",e,!1)}Object.defineProperty(e,"__esModule",{value:!0}),e.pageLoad=n,e.hashChange=o,e.pageUnload=r;var s=i(0)},function(t,e,i){"use strict";function n(t,e){var i=0;document.addEventListener("scroll",function(){var n=document.getElementsByTagName("body")[0],o=n.scrollTop/(n.offsetHeight-window.innerHeight)*100;o-i>1.5*e&&(i=Math.floor(o/e)*e),o>=i+e?(i+=e,t.events.trackScroll(i,"Arrive").send(),i>100&&(i=100)):o<=i-e&&(i-=e,t.events.trackScroll(i,"Arrive").send(),i>100&&(i=100))},!1)}function o(t){function e(t){for(var e=t.offsetTop,i=t.offsetLeft,n=t.offsetWidth,o=t.offsetHeight;t.offsetParent;)t=t.offsetParent,e+=t.offsetTop,i+=t.offsetLeft;return e<window.pageYOffset+window.innerHeight&&i<window.pageXOffset+window.innerWidth&&e+o>window.pageYOffset&&i+n>window.pageXOffset}var i,n,o,s=[],a=document.getElementsByTagName("*");for(o=0;o<a.length;o++)(" "+a[o].className+" ").indexOf(" track-visibility ")>-1&&s.push({element:a[o],visible:!1});document.addEventListener("scroll",function(){for(o=0;o<s.length;o++)i=s[o],e(i.element)!==i.visible&&(i.visible===!1?(i.visible=!0,i.timeStart=(0,r.getTimestamp)(),t.events.trackVisibility(i.element.id,i.timeStart).send()):i.visible===!0&&(i.visible=!1,n={start:i.timeStart,end:(0,r.getTimestamp)()},t.events.trackVisibility(i.element.id,n).send(),i.timeStart=null))},!1)}Object.defineProperty(e,"__esModule",{value:!0}),e.trackScrollRelative=n,e.trackScrollItems=o;var r=i(0)},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function o(t){return t&&t.__esModule?t:{default:t}}function r(t){if(this.utils=u,this.pulse2timing={init:(0,d.dateNow)()},!t)throw new Error("options object is required");if(!t.clientId)throw new Error("clientId is required");t.optOut||(this.optOut=!1,this.waitForOptOut=!1,t.waitForOptOut&&(this.optOut="wait",this.waitForOptOut=!0),this.vars=T,this.version=C,this.clientId=("sdrn:schibsted:client:"+t.clientId).toLowerCase(),t.url?(this.url=t.url+"/"+this.clientId,this.pixelUrl=t.url):(this.url=this.vars.envVars.dataCollectorUrl+"/"+this.clientId,this.pixelUrl=this.vars.envVars.dataCollectorUrl),this.pageViewId=(0,d.getUuidV4)(),this.pixel=new f.default(this.pixelUrl,"pulse2",t.pixelThrottle),this.pixel.initPulsePixel(this.pageViewId,this.clientId),this.pulse2timing={pixelDone:(0,d.dateNow)()},t.transport?this.transport=t.transport:this.transport=new g.default,t.respectDoNotTrack===!0&&navigator&&1===navigator.doNotTrack?this.allowTracking=!1:this.allowTracking=!0,this.opts=t,this.contentId=t.contentId||t.pageId||encodeURIComponent(document.location),this.contentType=t.contentType||t.pageType||"Content",this.userIdDomain=t.userIdDomain,this.noRedirect=!0,this.enrichmentFailed=!1,this.queue=new m.default(100,{persistOnUpdate:(t.trackingFetatures||{}).persistAllEvents}),this.opts.localCookieNotSet=!1,this.events=new c.default(this),this.user=new p.default({userId:this.opts.userId,userIdDomain:this.opts.userIdDomain,userServiceUrl:this.opts.userServiceUrl,noRedirect:this.noRedirect,transport:this.transport,utils:this.utils,waitForOptOut:this.waitForOptOut,jwe:this.opts.jwe}),this.plugins=new I.default(this.opts),this.trigger=new j.default(this.opts,this.plugins),this.initIds(function(){}),this.plugins.call(this.plugins.sdkLoad,this))}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),a=i(16),c=o(a),d=i(0),u=n(d),h=i(22),p=o(h),l=i(17),f=o(l),y=i(3),g=o(y),v=i(15),m=o(v),b=i(18),I=o(b),w=i(21),j=o(w),S=i(12),k=o(S),O=i(2),T=n(O),C="3.0.3";r.prototype.initIds=function(t){var e=this;t=t||function(){},this.opts.hybridAppMode&&!this.opts.jwe||((0,s.debug)("Fetching Ids"),this.pulse2timing.fetchIds=(0,d.dateNow)(),this.user.getUserId(function(i,n){e.idsDoneCallback(i,n,t),e.plugins.call(e.plugins.sdkReady,e)}))},r.prototype.idsDoneCallback=function(t,e,i){var n=this;return t?((0,s.debug)("Failed to fetch ids from CIS "+t),delete this.envId):(this.userId||(this.userId=e.userId),this.envId=e.envId),this.pulse2timing.receivedIds=(0,d.dateNow)(),this.waitingToTransmitQueue=!1,this.sendQueue(),this.user.syncIdsWithServer(function(){return new k.default(n.user).start()}),new k.default(this.user).start(),this.doPixelSync(),i(e)},r.prototype.doPixelSync=function(){var t,e="https://secure.adnxs.com/getuid?https://cis.schibsted.com/api/v1/sync?ANID=$UID";this.user.shouldSyncWithAn&&(this.user.shouldSyncWithAn=!1,this.user.setAnIdUnresolved(),t=new f.default(e,"pulse2an",1),t.initPixel())},r.prototype.sendQueue=function(t){var e,i,n=this;if(t=t||function(){},!this.queue.count())return t("no items in queue");if(!this.allowTracking)return t("tracking not allowed");if(this.plugins.call(this.plugins.eventCreated,this.queue.peekAll()),"send"!==this.isUserInfoResolved()||"send"!==this.optOutAction())return this.waitingToTransmitQueue=!0,t("not ready to send");for((0,s.debug)("Sending queue"),i=this.queue.dequeueAll(),e=0;e<i.length;e++)this.enrichEvents(i[e]);this.enrichmentFailed||(this.plugins.call(this.plugins.eventReady,i),this.transport.post(this.url,i,function(e){e?((0,s.debug)("Failed to send queue"),n.queue.enqueueMany(i),t(e)):(n.plugins.call(n.plugins.eventSent,i),t(null,!0))}))},r.prototype.send=function(t,e){var i=this;return e||(e=function(){}),this.allowTracking?(this.plugins.call(this.plugins.eventCreated,t),"send"!==this.isUserInfoResolved()||"send"!==this.optOutAction()?(this.queue.enqueue(t),this.waitingToTransmitQueue=!0,e("not ready to send")):((0,s.debug)("Sending object"),this.enrichEvents(t),void(this.enrichmentFailed||(this.plugins.call(this.plugins.eventReady,t),this.transport.post(this.url,[t],function(n){n?((0,s.debug)("Failed to send object"),i.queue.enqueue(t),e(n)):(i.plugins.call(i.plugins.eventSent,t),e(null,!0))}))))):e("tracking not allowed")},r.prototype.optOutAction=function(){return this.waitForOptOut&&"wait"===this.optOut?"wait":this.waitForOptOut&&this.optOut?"discard":"send"},r.prototype.setOptOut=function(t,e){return this.optOut=t,this.waitingToTransmitQueue=!1,this.sendQueue(e)},r.prototype.isUserInfoResolved=function(){return"undefined"==typeof this.envId?"SDK: Waiting for envId":this.envId.indexOf("undefined")>-1?(delete this.envId,"SDK: Waiting for envId"):this.user.doTracking===!1?"CIS: user has opted out":"send"},r.prototype.enrichEvents=function(t){this.addTheIds(t),t.tracker.performance&&(t.tracker.performance.pulse2.sendEvents=(0,d.dateNow)()),this.user&&this.user.localCookieNotSet&&(t.tracker.localCookieNotSet=!0)},r.prototype.addTheIds=function(t){var e=this.user.getTheEnvironmentId(),i=this.user.getTheUserId(),n=this.user.getTheJwe(),o=(0,d.objectKeys)(this.user.idObj.altEnvIds||{});if(t.actor&&e&&"undefined"!==e){if(0!==String(e).indexOf("sdrn:")){if(e.length>40)return void this.deleteEnvId();t.actor["@id"]="sdrn:schibsted:environment:"+e,t.device.environmentId="sdrn:schibsted:environment:"+e}else{if(e.length>70)return void this.deleteEnvId();t.actor["@id"]=e,t.actor["spt:environmentId"]=e,t.device.environmentId=e}n&&(t.device.jweIds=n),t.actor["spt:userId"]=i,o&&o.length>0&&(t.device.additionalEnvironmentIds=o)}},r.prototype.deleteEnvId=function(){this.enrichmentFailed=!0,delete this.user.idObj.envId,this.refreshUserIds()},r.prototype.getPageViewId=function(){return this.pageViewId},r.prototype.setNewPageViewId=function(){this.pageViewId=(0,d.getUuidV4)()},r.prototype.userLogout=function(){delete this.user.idObj.userId,this.refreshUserIds()},r.prototype.userLogin=function(t){this.user.idObj.userId=t,this.refreshUserIds()},r.prototype.refreshUserIds=function(){this.waitingToTransmitQueue=!0,this.user.didSync=!1,this.initIds()},r.prototype.setJWE=function(t){this.opts.hybridAppMode&&(this.opts.jwe=t,this.user.opts.jwe=t,this.initIds())},e.default=r},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t){this.referenceUrls=t.referenceUrls,this.user=t,this.transport=t.transport||new s.default,this.pointer=0}Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),s=n(r),a=i(0);o.prototype.start=function(){this.referenceUrls&&Array.isArray(this.referenceUrls)&&this.callCurrentIDService()},o.prototype.callCurrentIDService=function(){var t=this;this.pointer>20||this.referenceUrls.length<=this.pointer||!this.referenceUrls[this.pointer]||this.transport.get("https://"+this.referenceUrls[this.pointer]+"/api/v1/pulse",null,function(e,i){return t.handleResponse(e,i)},1,!0)},o.prototype.handleResponse=function(t,e){var i;if(this.pointer++,!t&&e&&e.responseText){try{i=JSON.parse(e.responseText)}catch(t){return}return i&&i.pulse2data?(this.cacheOldEnvironmentId(this.user.idObj.envId),void this.user.replaceCookieValue(i.pulse2data)):void this.callCurrentIDService()}},o.prototype.cacheOldEnvironmentId=function(t){var e,i,n,o,r,s,c={};if(this.user.idObj.altEnvIds=this.user.idObj.altEnvIds||{},this.user.idObj.altEnvIds[t]=(0,a.dateNow)(),e=Object.keys(this.user.idObj.altEnvIds),e.length>5){for(i=0;i<e.length;i++){for(r=this.user.idObj.altEnvIds[e[i]],o=0,n=0;n<e.length;n++)i!==n&&(s=this.user.idObj.altEnvIds[e[n]],parseInt(r,10)>parseInt(s,10)&&o++);o>=e.length-5&&(c[e[i]]=r)}this.user.idObj.altEnvIds=c}},e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return function(){}}},function(t,e,i){"use strict";function n(t,e){if(!t)throw new Error("data required");try{this.data=t.getSchema()}catch(t){throw new Error("get schema function required")}if(!t.activity)throw new Error("data must have property activity");this.activity=t.activity,this.objectOrder=e||[]}Object.defineProperty(e,"__esModule",{value:!0}),n.prototype.queue=function(){this.activity.queue.enqueue(this.data)},n.prototype.send=function(t){this.activity.send(this.data,t)},n.prototype.addProperty=function(t,e,i){var n=this.getObjectKey(t);return this.data[n][e]=i,this},n.prototype.addCustomData=function(t,e){var i=this.getObjectKey(t);return this.data[i]["spt:custom"]=e,this},n.prototype.getObjectKey=function(t){if("primary"===t)return this.objectOrder[0];if("secondary"===t)return this.objectOrder[1];if("tertiary"===t)return this.objectOrder[2];throw new Error("Object reference not valid")},e.default=n},function(t,e,i){"use strict";function n(t,e){if(!t)throw new Error("size of the queue must be given");this.options=e||{},this.maxSize=t,this.queue=[],this.options.loadFromLocalStorage&&this.loadFromLocalStorage()}Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r="_pulse2-queue";n.prototype.persistToLocalStorage=function(){try{(0,o.checkLocalStorage)(),localStorage.setItem(r,JSON.stringify(this.queue))}catch(t){}},n.prototype.loadFromLocalStorage=function(){var t;try{(0,o.checkLocalStorage)(),t=JSON.parse(localStorage.getItem(r)),t&&(0,o.isArray)(t)&&(this.queue=this.queue.concat(t))}catch(t){}},n.prototype.enqueue=function(t){this.queue.push(t),this.queue.length>this.maxSize&&this.queue.shift(),this.options.persistOnUpdate&&this.persistToLocalStorage()},n.prototype.enqueueMany=function(t){if(!(0,o.isArray)(t))throw new Error("elements must be an array");this.queue=this.queue.concat(t),this.queue.length>this.maxSize&&(this.queue=this.queue.slice(this.queue.length-this.maxSize,this.queue.length)),this.options.persistOnUpdate&&this.persistToLocalStorage()},n.prototype.dequeue=function(){var t=this.queue.shift();return this.options.persistOnUpdate&&this.persistToLocalStorage(),t},n.prototype.dequeueAll=function(){var t=this.queue.splice(0,this.queue.length);return this.options.persistOnUpdate&&this.persistToLocalStorage(),t},n.prototype.peek=function(){return this.queue[0]},n.prototype.peekAll=function(){return this.queue},n.prototype.count=function(){return this.queue.length},e.default=n},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t){if(!t)throw new Error("activity required");this.activity=t,this.opts=t.opts,this.contentId=t.contentId,this.contentType=t.contentType}function r(t){return"string"==typeof t&&t.indexOf("sdrn:")===-1?t.replace(/:/g,"%3A"):t}function s(t){return t&&"string"!==!("undefined"==typeof t?"undefined":a(t))?"ClassifiedAd"===t?"classified":"NotificationContent"===t?"notification":t.toLowerCase():t}Object.defineProperty(e,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=i(14),d=n(c),u=i(20),h=n(u),p=i(0),l=i(1);o.prototype.trackContentView=function(t){var e=new h.default(this.activity);return e.type="View",e.object=this.addPageStandards(e.object),e.object.name=t||document.title,e.object.properties={},e.object.properties=this.reMapCustom(e.object.properties,"@type"),e.object.properties=this.reMapCustom(e.object.properties,"action"),e.object.properties=this.reMapCustom(e.object.properties,"item"),this.opts.filters&&(e.object.filters=this.opts.filters),document.referrer&&(e.origin={url:document.referrer}),this.opts.targetId&&this.opts.targetType&&(e.target={},e.target=this.addPageStandards(e.target,this.opts.targetId,this.opts.targetType)),this.opts.contentType&&("classifiedad"===this.opts.contentType.toLowerCase()&&(e.schema.schema="http://schema.schibsted.com/events/ad-view-event.json/27.json#"),"listing"===this.opts.contentType.toLowerCase()&&(e.schema.schema="http://schema.schibsted.com/events/search-result-list-view.json/31.json#")),new d.default(e,["object","origin"])},o.prototype.trackBasic=function(t,e,i,n){var o=new h.default(this.activity);return e=e||"Content",i=i||"undefined",o.id=this.getSdrnIdWithContentType(i,e),o.type=t||"View","object"===("undefined"==typeof n?"undefined":a(n))?o.addCustomDataToProperty(o.object,n):(0,l.debug)("events.js:trackBasic: objectMeta must be an object",o.activity.opts.debugMode),o.object["@id"]=this.getSdrnIdWithContentType(i,e),o.object["@type"]=e,o.origin=this.addPageStandards(o.origin),new d.default(o,["object","origin"])},o.prototype.trackCreate=function(t,e,i){return this.trackBasic("Create",t,e,i)},o.prototype.trackUpdate=function(t,e,i){return this.trackBasic("Update",t,e,i)},o.prototype.trackReply=function(t,e,i){var n=new h.default(this.activity);return t=t||"Content",e=e||this.opts.contentId,n.id=this.getSdrnIdWithContentType(e,t),n.type="Send",n.addCustomDataToProperty(n.object,i),n.object["@type"]=t,n.origin=this.addPageStandards(n.origin),new d.default(n,["object","origin"])},o.prototype.trackRefer=function(t,e,i){return this.trackBasic("Refer",t,e,i)},o.prototype.trackReport=function(t,e,i){return this.trackBasic("Report",t,e,i)},o.prototype.trackLogin=function(t,e,i){return this.trackBasic("Login",t,e,i)},o.prototype.trackLogout=function(t,e,i){return this.trackBasic("Logout",t,e,i)},o.prototype.trackClick=function(t,e,i,n,o){var r=new h.default(this.activity);return r.type=o||"Accept",r.object["@id"]=this.getSdrnIdWithContentType(n,i)+":element:"+t,r.object["@type"]="Link",r.object.name=e,r.schema.target={"@id":this.getSdrnIdWithContentType(n,i),"@type":i},new d.default(r,["object","target"])},o.prototype.trackSocial=function(t,e,i){var n=new h.default(this.activity);return n.type=i||"Like",n.origin=this.addPageStandards(n.origin),n.object["@id"]=this.getSdrnIdWithContentType()+":element:"+t,n.object["@type"]="Link",n.schema.target={"@id":"sdrn:"+e.toLowerCase()+":action:"+n.type.toLowerCase(),"@type":"Service"},new d.default(n,["object","origin","target"])},o.prototype.trackMediaState=function(t,e,i){var n=new h.default(this.activity);return n.type=i||"Watch",n.object={"@type":e,"@id":this.getSdrnIdWithContentType()+":"+e+":"+t},n.origin=this.addPageStandards(n.origin),new d.default(n,["object","origin"])},o.prototype.trackScroll=function(t,e){var i=new h.default(this.activity);return i.type=e||"Arrive",i.object=this.addPageStandards(i.object),i.schema.result={"@type":"Place","@id":this.getSdrnIdWithContentType()+":scroll:"+t,"spt:depth":t},new d.default(i,["object","result"])},o.prototype.trackVisibility=function(t,e,i){var n=new h.default(this.activity);if("undefined"==typeof e)throw new Error("No time parameter was passed to this function");return n.type=i||"View",n.origin=this.addPageStandards(n.origin),n.object={"@type":"Content","@id":this.getSdrnIdWithContentType()+":element:"+t},e.start?n.object.startTime=e.start:e&&!e.end&&(n.object.startTime=e),e.end&&(n.object.endTime=e.end),new d.default(n,["origin","object"])},o.prototype.trackExit=function(t,e,i){var n=new h.default(this.activity);return n.type=i||"Leave",n.object=this.addPageStandards(n.object),n.schema.target={},"undefined"!=typeof t&&"undefined"!=typeof e&&(n.schema.target={"@type":e,"@id":this.getSdrnIdWithContentType(t,e)}),new d.default(n,["object","target"])},o.prototype.trackEngagement=function(t,e,i,n,o,r,s){var c,u=new h.default(this.activity);if(u.schema.schema="http://schema.schibsted.com/events/engagement-event.json/16.json#",u.type="Engagement",u.origin=this.addPageStandards(u.origin),s){if(c=s,"string"==typeof s)try{c=JSON.parse(s)}catch(t){(0,l.debug)("Error parsing JSON: "+t,u.activity.opts.debugMode)}"object"===("undefined"==typeof c?"undefined":a(c))&&u.addCustomDataToProperty(u.object,c)}return n&&o?(u.object["@id"]=u.origin["@id"]+":"+n+":"+o,u.object["@type"]=n,u.object.action=r):u.object=this.addPageStandards(u.object),t||0===t?u.schema.duration=t:u.schema.duration=(0,p.getViewDuration)(),e||0===e?u.schema.scrollPosition=e:u.schema.scrollPosition=(0,p.getScrollPosition)(),u.schema.action=i,new d.default(u,["object"])},o.prototype.trackEngagementTime=function(t,e,i){return this.trackEngagement(t,i)},o.prototype.trackCustomEvent=function(t,e,i){var n=new h.default(this.activity);return n.type=e||"Custom",n.object=this.addPageStandards(n.object),"object"===("undefined"==typeof i?"undefined":a(i))&&n.addCustomDataToProperty(n.object["spt:custom"],i),t&&(n.provider.eventIdentifier=t),new d.default(n,["object"])},o.prototype.trackCustom=function(t,e){var i=new h.default(this.activity);return i.type=t&&!~t.indexOf("custom:")?"custom:".concat(t):t||"custom:Content",i.object=this.addPageStandards(i.object),i.schema.schema="http://schema.schibsted.com/events/custom-event.json/0.json#","object"===("undefined"==typeof e?"undefined":a(e))&&(i.custom=e),new d.default(i,["object"])},o.prototype.addPageStandards=function(t,e,i){return e=e||this.activity.contentId,i=i||this.activity.contentType,t=t||{},t["@type"]=i,String(this.activity.contentId).indexOf("sdrn:")>-1?t["@id"]=e:t["@id"]=this.getSdrnIdWithContentType(e,i),t.contentId=e,t.url=document.URL,t.name=document.title,this.opts.inLanguage&&(t.inLanguage=this.opts.inLanguage),this.opts.tags&&(0,p.isArray)(this.opts.tags)&&(t.tags=this.opts.tags),this.validateAndSet(t,"adType",this.opts.adType,"string"),this.validateAndSet(t,"location",this.opts.contentLocation,"object"),this.validateAndSet(t,"publisher",this.opts.publisher,"object"),this.validateAndSet(t,"publisherType",this.opts.publisherType,"string"),this.validateAndSet(t,"images",this.opts.images,"object"),this.validateAndSet(t,"published",this.opts.published,"string"),this.validateAndSet(t,"creationDate",this.opts.creationDate,"string"),this.validateAndSet(t,"price",this.opts.price),this.validateAndSet(t,"currency",this.opts.currency,"string"),this.validateAndSet(t,"items",this.opts.items,"object"),this.addCategoryToEvents(t)},o.prototype.validateAndSet=function(t,e,i,n){if(e&&i)return n&&("undefined"==typeof i?"undefined":a(i))!==n?(console.log("not valid"+e+" : "+n),void(0,l.debug)(e+" is not of type "+n,this.activity.opts.debugMode)):void(t[e]=i)},o.prototype.addCategoryToEvents=function(t){var e=this.activity.opts,i="";return e.provider=e.provider||{},e.object=e.object||{},e.category?i=e.category:e.object.category?i=e.object.category:e.provider.category&&(i=e.provider.category),(0,p.isArray)(i)&&(i=i.toString()),i&&(t.category=i),t},o.prototype.getSdrnIdWithContentType=function(t,e){var i=r(t||this.activity.contentId),n=s(r(e||this.activity.contentType)),o=r(this.activity.opts.clientId);return String(i).indexOf("sdrn:")===-1?"sdrn:"+o+":"+n+":"+i:i},o.prototype.getDomainFromUrl=function(t){var e=t.match(/^https?\:\/\/(www.)?([^\/:?#]+)(?:[\/:?#]|$)/i);return e&&e[2]},o.prototype.reMapCustom=function(t,e,i){return i!==!1&&(i=!0),this.opts.object&&this.opts.object.properties&&this.opts.object.properties[e]?(t[e]=this.opts.object.properties[e],i&&delete this.opts.object.properties[e],t):t},e.default=o},function(t,e,i){"use strict";function n(t,e,i){this.collectorBaseUrl=t,this.service=e||"pulse2",this.clientId="",this.pageViewId="",this.throttle=.1,i>=0&&(this.throttle=i)}Object.defineProperty(e,"__esModule",{value:!0}),n.prototype.initPulsePixel=function(t,e){this.clientId=e,this.pageViewId=t,this.collectorBaseUrl=this.getImageTrackingUrl(this.collectorBaseUrl),
this.createPulsePixelUrl(),this.initPixel()},n.prototype.initPixel=function(){Math.random()<this.throttle&&this.collectorBaseUrl&&this.injectPixel()},n.prototype.createPulsePixelUrl=function(){var t="?provider.@id="+this.clientId;t+="&service="+this.service,t+="&@type=Pixel",t+="&@id="+this.pageViewId,this.collectorBaseUrl+=t},n.prototype.injectPixel=function(){var t=this.createImgElement(),e=document.getElementsByTagName("body");e.item(0).appendChild(t)},n.prototype.getImageTrackingUrl=function(t){var e="",i=/\/api\/v[0-9]\/track$/;try{e=t.replace(i,"/img")}catch(t){return}if(t!==e&&e)return e},n.prototype.createImgElement=function(){var t=document.createElement("img");return t.src=this.collectorBaseUrl,t.id=this.service+"pixel",t.style.display="none",t},e.default=n},function(t,e,i){"use strict";function n(t){this.opts=t,this.plugins=window.pulse2plugins||[],this.hooks={eventCreated:this.plugins.eventCreatedHooks||[],eventReady:this.plugins.eventReadyHooks||[],eventSent:this.plugins.eventSentHooks||[],load:this.plugins.onLoadHooks||[],ready:this.plugins.onReadyHooks||[]},this.sdkReady="ready",this.sdkLoad="load",this.eventCreated="eventCreated",this.eventReady="eventReady",this.eventSent="eventSent"}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=i(0),s=i(1);n.prototype.call=function(t,e){switch(t){case this.eventCreated:case this.eventReady:case this.eventSent:return this.callEventHooks(e,this.hooks[t]);case this.sdkReady:case this.sdkLoad:return this.callSdkHooks(e,this.hooks[t]);default:return}},n.prototype.callEventHooksArray=function(t,e){var i,n=[];for(i=0;i<t.length;i++)n.push(this.callEventHooks(t[i],e));return n},n.prototype.callEventHooks=function(t,e){var i,n,o,a;if(e=e||[],(0,r.isArray)(t))return this.callEventHooksArray(t,e);if(!t["@type"])return t;for(a=0;a<e.length;a++)if(i=e[a],n=(0,r.objectKeys)(i)[0].toLowerCase(),"all"===n||n===t["@type"].toLowerCase())try{o=i[n](t),o&&(t=o)}catch(t){(0,s.debug)("plugins.js: A pulse2 sdk plugin failed: "+t,this.opts.debugMode)}return t},n.prototype.callSdkHooks=function(t,e){var i;if("object"===("undefined"==typeof e?"undefined":o(e))&&"object"===("undefined"==typeof t?"undefined":o(t)))for(i=0;i<e.length;i++)try{e[i](t)}catch(t){(0,s.debug)("plugins.js: A pulse2 event plugin failed: "+t,this.opts.debugMode)}},n.prototype.on=function(t,e,i){var n={};t&&e&&(i?n[i]=e:n=e,this.hooks[t].push(n))},e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.envVars={dataCollectorUrl:"https://collector.schibsted.io/api/v1/track",userServiceUrl:"https://cis.schibsted.com/api/v1/identify",errorReportingUrl:""}},function(t,e,i){"use strict";function n(t,e){if(!t)throw new Error("Activity needed");this.activity=t,this.reducedEvent=e,this.schema={},this.type=null,this.actor={},this.device={},this.provider={},this.object={},this.origin={},this.location={},this.tracker={},this.initSchema()}Object.defineProperty(e,"__esModule",{value:!0});var o=i(0);n.prototype.initSchema=function(){this.schema["@id"]=(0,o.getUuidV4)(),this.activity.opts.intent&&(this.schema.intent=this.activity.opts.intent),this.schema.pageViewId=this.activity.pageViewId,this.schema.published=(0,o.getTimestamp)(),this.schema.creationDate=(0,o.getTimestamp)(),this.schema.schema="http://schema.schibsted.com/events/tracker-event.json/36.json",this.createActor(),this.createTracker(),this.createDevice(),this.createProvider(),this.createObject(),this.createOrigin(),this.createLocation(),this.addCustomData()},n.prototype.populateSchema=function(){this.schema["@type"]=this.type,this.schema.actor=this.actor,this.schema.tracker=this.tracker,this.schema.device=this.device,this.schema.provider=this.provider,this.schema.object=this.object,this.schema.origin=this.origin,this.schema.location=this.location,this.target&&(this.schema.target=this.target),this.result&&(this.schema.result=this.result),this.scrollPosition&&(this.schema.scrollPosition=this.scrollPosition),this.duration&&(this.schema.duration=this.duration),this.custom&&(this.schema.custom=this.custom)},n.prototype.createDevice=function(){if(!this.reducedEvent){this.device.deviceType=(0,o.getDeviceType)(navigator.userAgent),this.device.acceptLanguage=(0,o.getDeviceLanguage)(),this.device.screenSize=window.screen.width+"x"+window.screen.height,this.device.userAgent=navigator.userAgent,this.device.viewportSize=(0,o.getViewportDimensions)();try{(0,o.checkLocalStorage)(),this.device.localStorageEnabled=!0}catch(t){this.device.localStorageEnabled=!1}}},n.prototype.createObject=function(){this.object["spt:custom"]={}},n.prototype.createOrigin=function(){},n.prototype.createTracker=function(){this.tracker.version=this.activity.version,this.tracker.type="JS",this.activity.user&&this.activity.user.localCookieNotSet&&(this.tracker.localCookieNotSet=!0);try{(0,o.checkLocalStorage)()}catch(t){this.tracker.localStorageNotSet=!0}this.reducedEvent||this.extendedTrackerData()},n.prototype.extendedTrackerData=function(){this.tracker.performance={},this.tracker.performance.pulse2=this.activity.pulse2timing,this.tracker.name="Pulse v2 tracker JS SDK",window&&window.performance&&(this.tracker.performance.browser={},this.tracker.performance.browser=window.performance.timing)},n.prototype.createLocation=function(){this.activity.opts&&this.activity.opts.location&&(this.location["@type"]="Place",this.location.latitude=this.activity.opts.location.latitude,this.location.longitude=this.activity.opts.location.longitude,this.location.accuracy=this.activity.opts.location.accuracy)},n.prototype.createActor=function(){this.actor["@type"]="Person"},n.prototype.createProvider=function(){this.provider["@type"]="Organization",this.provider["@id"]=this.activity.clientId,this.provider.url=document.URL,this.provider.product=this.activity.opts.product||this.activity.opts.clientId,this.provider.productType=this.activity.opts.productType,this.provider.component=this.activity.opts.component},n.prototype.addCustomData=function(){this.activity.opts&&(this.addCustomDataToProperty(this.provider,this.activity.opts.provider),this.addCustomDataToProperty(this.object["spt:custom"],this.activity.opts.object))},n.prototype.addCustomDataToProperty=function(t,e){var i;for(i in e)t.hasOwnProperty(i)||(t[i]=e[i])},n.prototype.getSchema=function(){return this.populateSchema(),this.schema},n.prototype.getString=function(){return JSON.stringify(this.getSchema())},e.default=n},function(t,e,i){"use strict";function n(t,e){this.opts=t,this.plugins=e,this.registerTriggers()}Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),r=i(1);n.prototype.registerTriggers=function(){this.plugins&&this.plugins.on(this.plugins.sdkLoad,this.getUrlTriggers)},n.prototype.getUrlTriggers=function(t){var e,i,n,s,a,c,d=(0,o.getUrlParams)("p2param");for(i=0;i<d.length;i++){for(c={},s=d[i].split("."),n=s.slice(2),a=0;a<n.length;a++)try{n[a]=n[a].split("_"),c[n[a][0]]=n[a][1]}catch(t){(0,r.debug)("trigger.js: An error occurred while reading URL param: "+t,this.opts.debugMode)}e=t.events.trackCustomEvent(null,s[0],c),e.data.object.name=s[1],e.data.object["@id"]+=":elementId:"+s[1],e.send()}},e.default=n},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function o(t){return t&&t.__esModule?t:{default:t}}function r(t){t=t||{},this.idObj={},this.cookieKey="_pulse2data",this.envCookieKey="_pulse2env",this.cookiesAllowed=navigator.cookieEnabled,this.localCookieNotSet=!1,this.anonIdPlaceholder="x",this.opts=t,this.userIdDomain=t.userIdDomain||"schibsted.com",this.userId=this.opts.userId,this.userId||(delete this.userId,delete this.opts.userId),this.visitorIdPlaceholder="v",this.redirectString="https://cis.schibsted.com/redirect/?redirectUrl="+document.location,this.userServiceUrl=t.userServiceUrl||u.envVars.userServiceUrl,this.transport=t.transport||new c.default,this.referenceUrls=null,this.noRedirect=!0,this.doValidation=!1,this.shouldSyncWithAn=!1,this.shouldFetchFromAn=!1,this.hasCookie=!1,this.anSyncUrl="https://secure.adnxs.com/getuidj",this.doTracking=!0,this.anSyncStatus="nothing has happened",this.didSync=!1,"undefined"!=typeof t.noRedirect&&(this.noRedirect=t.noRedirect)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(0),a=i(3),c=o(a),d=i(2),u=n(d);r.prototype.getUserId=function(t){var e;return t=t||function(){},e=this.getIdsFromCookie(),this.userId&&(e.userId=this.createUserIdWithSdrn(this.userId)),this.mapUserData(e),this.idObj.envId?t(null,this.idObj):this.syncIdsWithServer(t)},r.prototype.syncIdsWithServer=function(t){var e=this;t=t||function(){},!this.idObj.envId||this.userStatusHasChanged()||this.doValidation||setTimeout(function(){return e.doAppNexusSync()},2e3),this.doValidation!==!0&&this.idObj.envId||this.didSync!==!1||(this.didSync=!0,this.getIdsFromService({envId:!this.idObj.jwe&&this.idObj.envId,jwe:this.idObj.jwe,userId:this.idObj.userId},function(i,n){return e.onIdServiceResponse(i,n,t)})),this.doValidation=!1,this.doAppNexusSync(null,function(){return t(null,e.idObj)})},r.prototype.replaceCookieValue=function(t,e){var i=this.getIdsFromCookie(t,e);this.mapUserData(i),this.syncIdsWithServer(),this.setIdsInCookie()},r.prototype.mapUserData=function(t){var e,i,n=["undefined","false","0","","null"];this.idObj.userId=t.userId||this.idObj.userId,this.idObj.envId=t.environmentId||t.envId,this.idObj.altEnvIds=t.altEnvIds||this.idObj.altEnvIds,this.idObj.prevUserId=t.prevUserId,this.idObj.anId=t.anId||this.idObj.anId,this.idObj.jwe=this.opts.jwe||t.jwe||this.idObj.jwe,this.idObj.pixelInjected=t.pixelInjected||null,this.idObj.adId=t.adId||this.idObj.adId||null,t.doAnSync&&(this.shouldSyncWithAn=t.doAnSync),this.doTracking=this.resolveDoTracking(t.doTracking),this.idObj.userId&&(e=this.idObj.userId.split(":"),i=e[e.length-1],n.indexOf(i)>=0&&delete this.idObj.userId),this.setIdsInCookie()},r.prototype.setIdsInCookie=function(){var t,e,i=this.idObj.userId||this.anonIdPlaceholder,n=new Date,o=new Date,r=new Date,a=n.getTime();this.idObj.envId&&(n.setTime(a+9e5),o.setTime(a+144e5),r.setTime(a+63072e6),t=[this.idObj.envId,this.visitorIdPlaceholder,i,n.getTime(),this.idObj.jwe,this.idObj.anId,o.getTime(),this.doTracking.toString(),this.idObj.pixelInjected,this.idObj.adId],(0,s.deleteCookie)(this.cookieKey,document.domain),(0,s.writeCookie)(this.cookieKey,t,(0,s.broadenDomain)(document.domain),r.toUTCString()),this.idObj.altEnvIds&&(0,s.writeCookie)(this.envCookieKey,JSON.stringify(this.idObj.altEnvIds),(0,s.broadenDomain)(document.domain),r.toUTCString()),e=(0,s.getCookie)(this.cookieKey),e||(this.localCookieNotSet=!0))},r.prototype.getIdsFromCookie=function(t,e){var i,n,o=t||(0,s.getCookie)(this.cookieKey),r=e||(0,s.getCookie)(this.envCookieKey);if(!o||o.indexOf("undefined")!==-1)return(0,s.deleteCookie)(this.cookieKey),this.shouldSyncWithAn=!0,{};if(i=o.split(","),i.length<2)return(0,s.deleteCookie)(this.cookieKey),{};if(i[3]&&(0,s.dateNow)()>parseInt(i[3],10)&&(this.doValidation=!0,this.hasCookie=!0),i[6]&&(0,s.dateNow)()>parseInt(i[6],10)&&(this.shouldSyncWithAn=!0,this.doValidation=!1),i[5]&&"unresolved"!==i[8]||(i[8]="unresolved",this.shouldFetchFromAn=!0),n={environmentId:i[0],prevUserId:i[2],jwe:i[4],anId:i[5],doTracking:i[7],pixelInjected:i[8],adId:i[9]},r)try{n.altEnvIds=JSON.parse(r)}catch(t){}return n},r.prototype.getIdsFromService=function(t,e){var i=this,n=this.userServiceUrl,o=3,r={userId:t.userId,jwe:t.jwe};t.envId&&(r.environmentId=t.envId),t.anId&&(r.anId=t.anId),this.opts.waitForOptOut&&(r.waitForOptOut=this.opts.waitForOptOut),this.hasCookie&&(o=1),this.transport.post(n,r,function(t,n){var o;return t?void e(t):(o=JSON.parse(n.response||n.responseText),o.data.anid&&"0"!==o.data.anid||(o.data.doAnSync=!0),i.mapUserData(o.data),void e(null,o.data))},!0,o)},r.prototype.onIdServiceResponse=function(t,e,i){return t?void i(t):(e&&e.crossReference&&Array.isArray(e.crossReference)&&(this.referenceUrls=e.crossReference),this.hasCookie?(this.hasCookie=!1,i(null,this.idObj)):i(null,this.idObj))},r.prototype.userStatusHasChanged=function(){var t=this.idObj.userId,e=this.idObj.prevUserId;return!!e&&(t&&e!==t.toString()||!t&&e!==this.anonIdPlaceholder)},r.prototype.doAppNexusSync=function(t,e){var i=this;return e=e||function(){},this.shouldFetchFromAn?(this.shouldFetchFromAn=!1,void this.transport.get(this.anSyncUrl,null,function(t,n){var o,r;return t?e(t,n):(o=JSON.parse(n.response||n.responseText),r={jwe:i.idObj.jwe,userId:i.idObj.userId,anId:o.uid},i.idObj.anId=o.uid,i.mapUserData(i.idObj),i.setAnIdResolved(),i.getIdsFromService(r,function(t,n){return i.onIdServiceResponse(t,n,e)}),e())},1,!0)):t},r.prototype.setAnIdUnresolved=function(){this.idObj.pixelInjected="unresolved",this.setIdsInCookie(this.idObj)},r.prototype.setAnIdResolved=function(){this.idObj.pixelInjected=null,this.setIdsInCookie(this.idObj)},r.prototype.getTheUserId=function(){return this.createUserIdWithSdrn(this.idObj.userId)},r.prototype.getTheEnvironmentId=function(){return this.idObj.envId},r.prototype.getTheJwe=function(){return this.idObj.jwe},r.prototype.getTheAdId=function(){return this.idObj.adId},r.prototype.createUserIdWithSdrn=function(t,e){return!t||String(t).indexOf("undefined")>-1?e:String(t).indexOf("sdrn:")>-1?t:"sdrn:"+this.userIdDomain+":user:"+t},r.prototype.resolveDoTracking=function(t){return t===!0||"true"===t||1===t||t!==!1&&"false"!==t&&0!==t&&this.doTracking},e.default=r},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function o(t){return t&&t.__esModule?t:{default:t}}function r(){var t=decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent("_pulse2debug").replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||!1;return t}Object.defineProperty(e,"__esModule",{value:!0});var s=i(4);Object.keys(s).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return s[t]}})});var a,c=i(5),d=o(c),u=n(s),h=i(2),p=n(h),l=i(1),f={},y=!1;r()&&(y=!0),"undefined"!=typeof pulse2opt?f=pulse2opt:"undefined"!=typeof _opt?f=_opt:(0,l.debug)("init.js: Could not find pulse2opt global variable",y),(0,l.debug)("bootstrapping Pulse",y),f.debugMode=y;try{a=f.cookieSyncUrl||p.envVars.cookieSyncUrl,u.initTracking(f),a&&d.default.initCookieSync({url:a,userId:f.userId})}catch(t){(0,l.debug)("init.js: Pulse2 init failed: "+t,y)}}])});var pulse2config = {
    "client": "leboncoin",
    "config": [
        {
            "throttle": 1,
            "dataCollector": "https://collector.schibsted.io/api/v1/track",
            "cis": "https://cis.schibsted.com/api/v1/identify"
        }
    ]
}
;